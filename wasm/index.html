<!DOCTYPE html>
<html>

<head>
    <title>Test Animation</title>
    <script src="build/bin/release/rive.min.js"></script>
</head>

<body>

    <canvas id="myCanvas" width=512 height=512></canvas>
    <script>
        Rive({
            locateFile: (file) => "build/bin/release/" + file,
        }).then((module) => {

            const {
                CanvasRenderer,
                LinearAnimationInstance,
                Alignment,
                Fit,
                load
            } = module;

            const assetRequest = new Request('../assets/juice.riv');

            fetch(assetRequest).then(function (response) {
                return response.arrayBuffer();
            }).then(function (buffer) {

                // Load Rive file from buffer.
                const file = load(new Uint8Array(buffer));

                // Get the default artboard.
                const artboard = file.defaultArtboard();

                // Get the number of animations in the artboard
                const animationCount = artboard.animationCount();
                console.log('Animation count: ' + animationCount);

                // Load an animation by index
                // const animation = artboard.animationAt(animationCount - 1);

                // Find an animation.
                const animation = artboard.animation("walk");


                // Make an animation instance (stores time and direction state
                // for a single animation). Make sure to call .delete on this
                // object when you are done with it.
                const animationInstance = new LinearAnimationInstance(animation);

                const canvas = document.getElementById("myCanvas");
                const ctx = canvas.getContext("2d");

                const renderer = new CanvasRenderer(ctx);
                artboard.advance(0);
                artboard.draw(renderer);

                let lastTime = 0;

                function drawFrame(time) {
                    if (!lastTime) {
                        lastTime = time;
                    }
                    const elapsedSeconds = (time - lastTime) / 1000;
                    lastTime = time;

                    animationInstance.advance(elapsedSeconds);
                    animationInstance.apply(artboard, 1.0);
                    artboard.advance(elapsedSeconds);

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.save();
                    renderer.align(Fit.contain, Alignment.center, {
                        minX: 0,
                        minY: 0,
                        maxX: canvas.width,
                        maxY: canvas.height
                    }, artboard.bounds);
                    artboard.draw(renderer);
                    ctx.restore();

                    requestAnimationFrame(drawFrame);
                }
                requestAnimationFrame(drawFrame);

            });
        });
    </script>
</body>

</html>