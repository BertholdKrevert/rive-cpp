<!DOCTYPE html>
<html>

<head>
    <title>Test Animation</title>
    <script src="build/bin/release/rive.min.js"></script>
</head>

<body>

    <canvas id="myCanvas" width=512 height=512></canvas>
    <script>
        Rive({
            locateFile: (file) => "build/bin/release/" + file,
        }).then((module) => {

            const {
                CanvasRenderer,
                load
            } = module;

            const assetRequest = new Request('../assets/juice.riv');

            fetch(assetRequest).then(function (response) {
                return response.arrayBuffer();
            }).then(function (buffer) {
                const file = load(new Uint8Array(buffer));
                const artboard = file.defaultArtboard();
                const animation = artboard.animation("walk");

                const canvas = document.getElementById("myCanvas");
                const ctx = canvas.getContext("2d");

                const renderer = new CanvasRenderer(ctx);
                artboard.advance(0);
                artboard.draw(renderer);

                let lastTime = 0;

                function drawFrame(time) {
                    if (!lastTime) {
                        lastTime = time;
                    }
                    const elapsedSeconds = (time - lastTime) / 1000;
                    lastTime = time;

                    const duration = animation.duration/animation.fps;
                    
                    animation.apply(artboard, 0.5 + ((time/1000)%1), 1.0);
                    artboard.advance(elapsedSeconds);

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.save();
                    ctx.translate(-250, 80);
                    ctx.scale(0.5, 0.5);
                    artboard.draw(renderer);
                    ctx.restore();

                    requestAnimationFrame(drawFrame);
                }
                requestAnimationFrame(drawFrame);

            });
        });
    </script>
</body>

</html>